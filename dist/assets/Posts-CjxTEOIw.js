import{G as ue,u as p,r as a,j as s,A as M,M as xe,C as he,a as fe,s as S,b as x,I as ge,F as pe,H,c as je,d as we,e as be,P as ke,f as Ce,g as _e,h as Ne,i as ye,k as ve,l as Se,R as Me,B,m as V}from"./index-D5uX2KMA.js";function Pe(n){return ue({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"m3 3 3 9-3 9 19-9Z"},child:[]},{tag:"path",attr:{d:"M6 12h16"},child:[]}]})(n)}function De({}){const n=p(d=>d.ui.isDarkMode),[m,o]=a.useState(!1),c=p(d=>d.user.user);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:` hidden h-24 lg:flex mt-32 ${n?"bg-black border":"bg-gray-100"} items-center   mx-auto shadow-md rounded-xl border-gray-600  lg:w-3/5 mb-20  `,children:[c.profile?s.jsx("img",{className:"h-10 w-10 mx-5 object-cover rounded-full",src:c.profile,alt:""}):s.jsx(M,{size:"35",className:"rounded-full mx-5",name:c.name}),s.jsx("input",{type:"tel",onClick:()=>o(!0),id:"newPost",autoComplete:"off",className:`bg-gray-50 border  border-gray-300 text-gray-900 ${n?"bg-gray-900":""} text-sm mx-5 rounded-full focus:ring-blue-500 focus:border-blue-500  w-72 p-2.5 h-10`,placeholder:"Type something . . . . ."}),s.jsxs("div",{className:" flex w-32 ml-20 gap-3",children:[s.jsx(xe,{size:20}),s.jsx(Pe,{size:20})]})]}),m&&s.jsx(he,{setOpenModal:o})]})}function $e(){const n=p(e=>e.ui.isDarkMode),m=fe(),o=p(e=>e.user.user),[c,d]=a.useState([]),[P,D]=a.useState(null),j=a.useRef(null),[h,G]=a.useState(0),[J,E]=a.useState(!0),[w,$]=a.useState(null),[I,W]=a.useState({}),[Z,q]=a.useState({_id:"",status:!0}),[b,U]=a.useState(""),[k,z]=a.useState({postId:"",error:""}),[f,g]=a.useState({_id:"",status:!0}),[O,C]=a.useState(""),[A,_]=a.useState(""),[K,N]=a.useState(!1),L=async()=>{try{const e=await x.getAllPosts(0);e&&(N(!1),d(e.posts),localStorage.setItem("posts",JSON.stringify(e.posts)),c.sort((l,r)=>new Date(r.createdAt).getTime()-new Date(l.createdAt).getTime()),E(e.posts.length>0))}catch(e){console.log("err fetchin  gposts"),console.log(e);const l=localStorage.getItem("posts"),r=l?JSON.parse(l):null;d(r)}};a.useEffect(()=>(S.emit("login",{userId:o._id}),()=>{S.off("login")}),[o._id]),a.useEffect(()=>{L()},[K]),a.useEffect(()=>{function e(l){j.current&&!j.current.contains(l.target)&&D(null)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);const Q=e=>{D(P===e?null:e)},X=a.useCallback(async()=>{try{const e=await x.getAllPosts(h);e&&(d(l=>[...l,...e.posts]),E(e.posts.length>0))}catch(e){console.log(e)}},[h]),Y=a.useCallback(()=>{G(e=>e+1)},[]);a.useEffect(()=>{h>0&&X()},[h]);const ee=a.useCallback(async(e,l,r)=>{try{const i=await x.likePost(e,l,r);i&&(d(t=>t.map(u=>{if(u._id===e){const v=i.likes;return{...u,likes:{...u.likes,...v}}}return u})),S.emit("notification",r))}catch(i){console.log(i)}},[c]),se=a.useCallback(async(e,l)=>{try{const r=await x.unLikePost(e,l);r&&(d(i=>i.map(t=>{if(t._id===e){const u=r.likes;return{...t,likes:{...t.likes,...u}}}return t})),console.log(c))}catch(r){console.log(r)}},[c]),te=async e=>{const l=`${window.location.origin}/post/${e}`;if(navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(l),B.success("Link copied",{position:"top-center",autoClose:3e3,hideProgressBar:!0,closeOnClick:!0,progress:void 0,theme:"light",transition:V})}catch(r){console.error("Failed to copy: ",r),B.error("Failed to copy link",{position:"top-center",autoClose:3e3,hideProgressBar:!0,closeOnClick:!0,progress:void 0,theme:"light",transition:V})}},le=async e=>{$(w===e?null:e)},re=e=>{W(l=>({...l,[e]:(l[e]||2)+2}))},ae=async(e,l)=>{if(!b.trim()){z({postId:e,error:"Enter a comment"});return}z({postId:"",error:""});try{const r=await x.commentPost(b,e,l);r&&(d(i=>i.map(t=>t._id===e?{...t,comments:[...t.comments,r]}:t)),N(!0),U(""))}catch(r){console.log(r)}},[ie,y]=a.useState(!1),[R,ne]=a.useState(""),F=()=>{y(!0)},oe=()=>{y(!1)},ce=async e=>{await x.reportPost(R,e),console.log(R,e),y(!1)},de=async(e,l)=>{try{await x.deleteComment(e,l),d(r=>r.map(i=>i._id===e?{...i,comments:i.comments.filter(t=>t._id!==l)}:i))}catch(r){console.log(r)}},T=async(e,l)=>{try{q({_id:e,status:l}),g({_id:e,status:l})}catch(r){console.log(r)}},me=async(e,l)=>{if(!A.trim()){C("Comment should be atleast one character");return}try{C(""),await x.editComment(e,l,A),_(""),g({_id:"",status:!0})}catch(r){_(""),C(""),console.log(r)}};return s.jsxs("div",{className:` mt-16 pt-1 lg:mt-0 ${n?"bg-black text-white":""} col-span-full   overflow-auto h-svh lg:col-start-2 lg:col-end-5`,id:"scrollableDiv",children:[s.jsx(De,{fetchPost:L,fetchAgain:N}),s.jsx(ge,{dataLength:c.length,next:Y,hasMore:J,loader:s.jsx(s.Fragment,{}),endMessage:s.jsx("div",{className:"text-center py-4 text-xs text-gray-500 w-full  h-40"}),scrollableTarget:"scrollableDiv",children:s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:"w-full lg:w-3/5",children:c.length>0&&c.map(e=>{var l,r,i;return s.jsxs("div",{className:`w-full ${n?"bg-black text-white":""} flex flex-col justify-between items-center mb-10 relative`,children:[s.jsxs("div",{className:"flex items-center mb-3 p-2 w-full",children:[(r=(l=e.postedUser)==null?void 0:l.profile)!=null&&r.image?s.jsx("img",{onClick:()=>o._id===e.postedUser._id?m("/profile"):m(`/profile/${e.postedUser.username}`),className:"w-10 h-10 mr-4 cursor-pointer rounded-full",src:e.postedUser.profile.image}):s.jsx(M,{onClick:()=>o._id===e.postedUser._id?m("/profile"):m(`/profile/${e.postedUser.username}`),name:e.postedUser.username.slice(0),className:"rounded-full me-4 cursor-pointer",size:"35"}),s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center w-full justify-between",children:[s.jsx("div",{onClick:()=>o._id===e.postedUser._id?m("/profile"):m(`/profile/${e.postedUser.username}`),className:"text-base cursor-pointer md:text-lg font-semibold flex gap-3",children:s.jsx("p",{children:e.postedUser.username})}),s.jsx("div",{className:"text-xs text-gray-500 mt-1 md:mt-0 flex gap-2",children:pe(e.createdAt)})]}),s.jsxs("div",{ref:j,children:[s.jsx(H,{className:"ml-1 cursor-pointer",size:20,onClick:()=>Q(e._id)}),P===e._id&&s.jsx("div",{className:`absolute mt-2 right-0 z-10   shadow-lg  ${n?"bg-neutral-950":"bg-gray-200"}  rounded-lg w-32`,children:e.postedUser._id!==o._id&&s.jsxs("ul",{className:"py-2 space-y-3 text-sm",children:[s.jsx("li",{className:""}),s.jsx("li",{onClick:F,onMouseOver:()=>{F(),ne(e._id)},className:"mx-4 cursor-pointer ",children:s.jsx("button",{children:"Report"})})]})})]})]}),((i=e.image)==null?void 0:i.length)>0&&s.jsx(je,{content:e}),s.jsx("div",{className:`w-full ${n?"bg-black":""} flex items-center mt-2 p-2 md:p-0 sm:text-sm font-light md:font-normal break-words`,children:s.jsx("p",{className:"text-wrap mx-2 w-full",children:e.description})}),s.jsx("div",{className:`w-full ${n?"bg-black":""} flex justify-around gap-8 p-4`,children:s.jsxs("div",{className:"flex w-full gap-10",children:[s.jsx(we,{className:e.likes.userId&&e.likes.userId.includes(o._id)?"text-red-500":`${n?"text-white":"text-black"} cursor-pointer`,onClick:()=>{e.likes.userId&&e.likes.userId.length>0&&e.likes.userId.includes(o._id)?se(e._id,o._id):ee(e._id,o._id,e.postedUser._id)},size:25}),s.jsx(be,{size:20,className:"font-bold cursor-pointer",onClick:()=>le(e._id)}),s.jsx(ke,{onClick:()=>te(e._id),size:25,className:"font-bold cursor-pointer"})]})}),s.jsxs("div",{className:"flex w-full px-4 gap-5",children:[s.jsxs("p",{className:"text-xs flex",children:[e.likes.userId?e.likes.userId.length:0," likes"]}),s.jsxs("p",{className:"text-xs flex",children:[e.comments[0].comment?e.comments.length:0," ","comments"]})]}),w===e._id&&s.jsxs("div",{className:`w-full ${n?"bg-black text-white":""} ${w?"h-auto ":"h-full"} transition-all duration-500 ease-in-out flex flex-col`,children:[s.jsxs("div",{className:"w-full px-4",children:[s.jsx("div",{className:"mt-4",children:e.comments.length>0&&e.comments[0].comment&&e.comments.slice(0,I[e._id]||2).map((t,u)=>s.jsxs("div",{className:"flex items-center  mb-2 ",children:[t.commenterImage?s.jsx("img",{className:"w-7 h-7 rounded-full me-4",src:t.commenterImage,alt:""}):s.jsx(M,{name:t.commenter.slice(0),className:"rounded-full me-4",size:"28"}),s.jsxs("div",{className:"flex flex-col break-words w-80 md:w-96",children:[s.jsxs("p",{className:"text-sm font-semibold  text-wrap flex gap-1",children:[t.commenter,t.isPremium?s.jsx(Ce,{className:"text-blue-600 mt-1"}):""]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("input",{className:`${f._id===t._id&&"border  border-gray-300 mx-1 p-1 rounded-full"} ${n?"bg-black":"bg-gray-200"}`,onChange:v=>_(v.target.value),type:"text",defaultValue:t.comment,disabled:f._id!==t._id}),O.trim()&&f._id===t._id&&s.jsx("p",{className:"text-red-600 text-xs",children:O})]})]}),t.commentedUserId==o._id&&s.jsx("div",{className:"flex gap-1 mt-4",children:s.jsx(H,{onClick:()=>{T(t._id,!1),g({_id:"",status:!0})}})}),Z._id===t._id&&s.jsxs("ul",{className:`flex flex-col gap-2 ${n?"bg-gray-900":" bg-gray-300"} rounded-xl p-2 relative right-0 top-8 z-10`,children:[s.jsx("li",{children:s.jsx(_e,{onClick:()=>T("",!0),className:"float-right cursor-pointer"})}),s.jsx("li",{children:f.status?s.jsx(Ne,{onClick:()=>g({_id:t._id,status:!1})}):s.jsx(ye,{size:15,onClick:()=>me(e._id,t._id)})}),s.jsxs("li",{children:[s.jsx(ve,{onClick:()=>de(e._id,t._id)})," "]})]})]},u))}),e.comments.length>(I[e._id]||2)&&s.jsx("button",{className:"text-xs text-blue-500 mt-2",onClick:()=>re(e._id),children:"Show more"})]}),s.jsxs("div",{className:"flex justify-start p-4 gap-3",children:[s.jsx("input",{value:b,onChange:t=>U(t.target.value),type:"text",className:`${n?"bg-gray-950":"bg-gray-200"} w-80 md:w-96 h-10 p-3 rounded-full`,placeholder:"Add a comment..."}),s.jsx("span",{className:"p-3",children:s.jsx(Se,{onClick:()=>ae(e._id,o._id),size:23})})]}),k.error&&k.postId===e._id&&s.jsx("p",{className:"text-red-500 text-sm px-4 -mt-2",children:k.error}),s.jsx("button",{className:"text-xs text-blue-500 mt-2",onClick:()=>$(null),children:"hide"})]})]},e._id)})})})}),s.jsx(Me,{isOpen:ie,onClose:oe,onSubmit:ce})]})}export{$e as default};
